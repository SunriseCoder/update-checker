<link rel="import" href="/bower_components/polymer/polymer.html" />
<link rel="import" href="/bower_components/iron-ajax/iron-ajax.html" />

<script src="/scripts/locale-utils.js"></script>
<script src="/scripts/table-utils.js"></script>

<dom-module id="custom-table">
	<template>
		<iron-ajax id="tableDataAjax" content-type="application/json"
				on-response="_tableDataOk" on-error="_tableDataError"></iron-ajax>

		<!-- Table -->
		<table border="1">
			<!-- Headers -->
			<tr>
				<template is="dom-repeat" items="[[_parsedColumns]]">
					<th>[[_columnLabel(item)]]</th>
				</template>
				<th>[[i18n('columns.actions')]]</th>
			</tr>

			<!-- Data -->
			<template is="dom-repeat" items="[[data]]" as="row">
				<tr>
					<template is="dom-repeat" items="[[_parsedColumns]]" as="column">
						<td>[[_columnValue(row, column)]]</td>
					</template>
				</tr>
			</template>
		</table>
	</template>

	<script>
    Polymer({
    	is: "custom-table",

    	properties: {
    		entity: String,
    		columns: String,
    		dataBaseUrl: String,
    		_parsedColumns: Array,
    		data: Array
    	},

    	i18n: function(key) {
   			return Locales.i18n(key);
    	},

    	_columnLabel(name) {
    		return Locales.i18n('columns.' + this.entity + '.' + name);
    	},
    	
    	_columnValue(row, column) {
    		return row[column];
    	},

    	ready: function() {
    		this._parsedColumns = Table.parseColumns(this.columns);
    		this.refresh();
    	},

    	refresh: function() {
    		this._loadData();
    	},

    	_loadData: function() {
    		this.$.tableDataAjax.url = this.dataBaseUrl + 'list';
    		this.$.tableDataAjax.generateRequest();
    	},

    	_tableDataOk: function(event) {
    		this.data = event.detail.response;
    	},

    	_tableDataError: function(event) {
    		//TODO
    	}
    });
  </script>
</dom-module>
